<html>
	<head> <title> Chapter 11 </title> </head>
	
	<body>
		<h1 align = "center"> Chapter 11 </h1>
		<div style="position: absolute;right: 0px;width: 300px;direction: rtl;"> 
			<h2> Introduction </h2>
			<p> هانتكلم النهارده عن حاجة مهمه جدا و كلنا هانحبها .. هانتكلم عن بعض مبادىء الامن فى لينكس </p>
			<p>  هانشوف ازاى نقدر نستخدم ال root صح و اهميتة و خطورة لو حد غير مسئول اصبح root </p>
			<p> هانتكلم عن ال passwords و ازاى بتتخزن و بتتشفر و هانشوف كمان ال accounts اللى فى النظام معانا ازاى نقدر نشوفها و نعرف مين دخل امتى </p>
			<p>  فى الاخر هانتعلم ازاى النظام بتاعنا مايبقاش صيد سهل لاى حد يفكر انه يتدخل فيه </p>
			<h2> Section 1 </h2>
			<p>  فى نظام لينكس بيطلب اثبات من كل مستخدم ان هو المستخدم ده .. و بيقدر يعرفهم من بعض عن طريق انه مخزنهم عنده </p>
			<p> مخزنهم فى قاعدة بيانات بتضم اسم كل مستخدم و ال UID او ال user id اللى اتكلمنا عنه قبل كده </p>
			<p> و كمان بيتخزن معاهم ال home directory بتاع كل مستخدم فيهم و الملفات المهمه لكل واحد المتعلقة بال home بتاعة </p>
			<p> طيب و قاعدة البيانات ديه كلها بتتخزن فين ؟ </p>
			<p> بتتخزن فى الملف اللى موجود فى /etc/passwd </p>
			<p> و اللى بيتخزن هو : </p>
			<ul> 
				<li> Username: الاسم اللى بيعمل بيه login و ده فى لينكس لازم يكون حجمة يا اما حرف واحد يا اما 32 حرف </li>
				<li> Password: و ده بيتحفظ فى الملف /etc/shadow و طبعا بيكون متشفر و هانتكلم النهارده عن طريقة تشفيرة ازاى بس قدام حبتين </li>
				<li> User ID (UID): اللى بيتسجل بيه كل مستخدم و مافيش مستخدمين ليهم نفس ال ID </li>
				<p> و دايما  ال id رقم 0 بيكون محدوز لل root user اما من 1 ل 99 بيتسجل بيه المستخدمين </p>
				<p> و من 100 ل 999 بيتسجل لل system accounts و ال groups ماعدا توزيعة RHEL اللى بتحجز من فوق 499 </p>
				<p> و اللى اعلى من 1000 محجوز لل normal user ماعدا RHEL اللى بتبدا من 500 </p>
				<li> Group ID (GID): و اللى مسئول عن حفظ كل مستخدم مشترك فى انهى group و ده بيتسجل فى /etc/group </li>
				<li> User Info: و ده بيكون فيه شوية معلومات زيادة عن اسمه بالكامل ايه </li>
				<li> Home Directory: ملف ال home المخصوص عشان المستخدم ده </li>
				<li> Shell: المكان اللى بيكون فيه ال shell بتاع المستخدم ده </li>
			</ul>
			<h5> Types Of Accounts </h5>
			<p> فيه لينكس بيقسم المستخدمين لاربع انواع هما : </p>
			<ul>
				<li> root </li>
				<li> system </li>
				<li> Normal </li>
				<li> Network </li>
			</ul>
			<p> و من الحاجات الكويسة للامان انك تشيل اى مستخدم مالوش لازمة فى النظام و كمان ماتديش صلاحيات كبيرة لكل المستخدمين و مش لاى حد </p>
			<p> و عشان اقدر اعرف اكتر عن المستخدمين دخلوا امتى عشان اقدر اعرف مين المستخدم اللى مش بيستخدم النظام من فترة و اشيلة لو مش مختاجة </p>
			<p> بنستخدم الامر last </p>
			<h5> root account </h5>
			<p> خلونا نتكلم اكتر عن البوب الكبير ال root </p>
			<p> هو الشخص اللى ليه كل الصلاحيات فى النظام </p>
			<p> هو اللى يقدر يضيف مستخدم جديد او يمسح مستخدم موجود </p>
			<p> هو اللى يقدر ينزل برنامج جديد و يثبتة على النظام او يشيلة </p>
			<p> يقدر كمان يغير ال password بتاع المستخدمين و يدير الملفات زى ماهو عايز </p>
			<p> و عشان كده لما تيجى تتعامل كا root فى ال shell هاتلافية غير العلامة الى شكل الشباك # </p>
			<p> و كأنة بيحذرك من القوة اللى انت بتمتلكها دلوقتى </p>
			<p> طيب هل المستخدمين العاديين يقدروا ينزلوا برامج ويسطبوها .. اه يقدروا ينزلوا البرنامج و يثبتوة </p>
			<p> طيب و ال root ايه الزيادة اللى عنده </p>
			<p> هو لوحده يقدر يعمل انه ينزل برامج معينة ماتضافش غير يدوى منه هو او انه يفتح ملفات مهمه جدا فى النظام هو الوحيد اللى يقدر يفتحها </p>
			<h5> طيب ازاى اقدر اضيف مستخدم جديد ؟ </h5>
			<p> فى ال command line هاكتب الامر useradd <username>  زى مثلا useradd Mohamed </p>
			<p> و عشان اضيف password هاكتب الامر  passwd <username> مثال passwd Mohamed </p>
			<p> بعدها هايطلب منى ال password هادخلة زى مثلا moh12345 </p>
			<p> بعدها هايطلب تاكيد عليه فا هادخلة تانى و بعدها هايظهرلى رسالة يقولى ان ال password خلاص اتعمل </p>
			<p>  passwd: all authentication tokens updated successfully </p>
			<h5> العمليات اللى مش محتاجة تصريح root عشان اعملها </h5>
			<ul>
				<li> Running a network client : انى اعمل share لملفات عندى و اشاركها مع الشبكة اللى معايا </li> 
				<li> Using devices: زى ال printer اللى مشترك معاها فى نفس الشبكة </li>
				<li> Operations on files that the user has proper permissions to access: اى ملفات مسمحولى اشوفها سواء كانت على النظام او الشبكة </li>
				<li> Running SUID-root applications : انى افتح برامج معينة</li>
			</ul>
			<h2> Section 3 </h2>
			<p> قلنا قبل كده ان ممكن المستخدم العادى ياخد شوية صلاحيات من ال root عن طريق امرين su و الامر sudo و السؤال هنا ايه الفرق بينهم ؟ </p>
			<p> su :  </p>
			<ul>
				<li> لما اكتب الامر su بيطلب منى ال root password و اللى من قواعد الامن انى ماديش ال password بتاع ال root لاى حد </li>
				<li> اول ما ادخل ال password بتاع ال root وقتها اقدر اخد كل صلاحيات ال root و لمدة طويلة من غير ما كل شوية يطلب منى ال password تانى </li>
			</ul>
			<p> sudo : </p>
			<ul>
				<li> لما بكتب الامر بيطلب منى ال password بتاع المستخدم اللى انا موجود عليه مش ال root </li>
				<li> الصلاحيات اللى بياخدها بتكون اقل و العمليات اللى يقدر يعملها محدودة و كل مره عايز اعمل علمية جديدة محتاج انى ادخل ال password تانى و ده طبعا حاجة مهمة جدا فى الامان </li>
			</ul>
			<h5> Process Isolation </h5>
			<p> من اكتر الوظائف اللى بتميز لينكس فى انه امن عن غيرة من الانظمة التانية مفهوم ان كل عملية مفصولة عن التانية </p>
			<p>بمعنى ادق ان كل عملية شغالة ماتقدرش تستخدم عملية تانية شغالة او تغير فيها لا كل واحده بمعزل عن التانى</p>
			<p> و ده بيحصل حتى لو كانت ال process فى نفس مستوى الصلاحيات بالنسبة للتانية </p>
			<p> طيب ايه فايدة العملية ديه .. الفايدة الكبيرة اللى فيها انها تمنع الفيروسات انها تاثر على العمليات اللى شغالة على الجهاز و توقفها او تدمرها </p>
			<p> بعض الاجراءات الامنية فى لينكس : </p>
			<ul>
				<li> Control Groups (cgroups): انى اتحكم كا system administrator فى العمليات اللى شغالة و اقسمها groups </li>
				<li> Linux Containers (LXC): و هى انى اشغل اكتر من نظام لينكس كل واحد منفصل عن التانى و كل واحد شغال كا نظام لوحده </li>
				
			</ul>
			<h5> حاجو مهمة جدا لازم نكون كلنا عارفنها ان القائمين على لينكس دايما بيصلحوا الاخطاء اللى فيه سواء كانت امنية او غير امنية اول باول </h5>
			<h5> و ان هما اول مابيصلحوها على طول بيعملوا update للنسخة الموجودة من ال kernel دلوقتى </h5>
			<h5> عشان كده لازم كل فترة تعمل update للتوزيعة اللى معاك عشان تقدر تواكب التغيرات الجديدة </h5>
			<h2> Section 4 </h2>
			<p> سبق و قولنا قبل كده ان ال passwords بتتسجل فى /etc/passwd و ده ممكن يخليها اى حد يشوفها </p>
			<p> و قولنا برضة انه متشفرة بحيث ان مش اى حد يشوفها غير ال root و التشفير موجود فى الملف /etc/shadow </p>
			<p> و الشفرة بتاعت ال password هى عبارة عن خوارزمية اسمها SHA-512 او (Secure Hashing Algorithm 512 bits) و ديه انشأتها ال NSA فى امريكا لحماية ال passwords بتاعتها </p>
			<p> و هى فى الحقيقة مستخدمة كتير جدا زى TLS , SSL, PHP , SSH </p>
			<p>  ولو حابب تجرب الخوارزمية على مثال معين و لو افترضنا كلمة test </p>
			<p> هانكتب الامر : </p>
			<p> echo -n test | sha512sum </p> 
			<p> و ساعتها الناتج هايطلع بالمنظر ده </p>
			<p> ee26b0dd4af7e749aa1a8ee3c10ae9923f618980772e473f8819a</p>
			<p>5d4940e0df27ac185f8a0e1d5f84f88bc887fd67b143732c304cc</p>
			<p> 5fa9ad8e6f57f550028a8ff </p>
			<p> و طبعا شفرة سهلة جدا زى ما كلنا شايفين :D </p>
			<p> و فيه طرق متوفرة فى لينكس عشان اقدر احفظ ال password بتاعى زى </p>
			<ol>
				<li> Password aging: و هى طريقة انى ادى expired date لل password بتاعى و قبلها يطلب منى النظام password جديد لان ده خلاص قرب تنتهى صلاحيتة </li>
				<p> و ديه طبعا مفيدة جدا فى حالة ان ال password بتاعى حد قدر يعرفة </p>
				<p> و عشان اعرف معلومات اكتر عن الحاجات ديه اقدر اكتب الامر chage </p>
				<li> تانى حاجة تقدر تساعدنى فى انها تعرف اذا كان ال password قوى كفاية و لا لا هى PAM </li>
				<p> و هى اختصار ل Pluggable Authentication Modules  </p>
				<p> و هى بتقدر تعرف اذا كان قوى و لا لا عن طريق مكتبة اسمها pam_cracklib.so و فيه بعض الاحيان بتستخدم مكنها المكتبة pam_passwdqc.so </p>
				<li> و فيه طريقة كمان انى انزل برنامج يقدر يعرف مواطن الضعف فى ال password بتاعى زى برنامج  Jack The Ripper عشان اقدر اصلح مواطن الخلل ديه </li>
			</ol>
			
			<h5> Requiring Boot Loader Passwords </h5>
			<p> و احدة من اهم الخطوات فى الامان اللى للاسف فيه كتير بينسوها و هى انى امنع ان حد يعمل boot من اى لاى driver من غير مايدخل ال password  اللى انا حاطة </p>
			<p> و ده عشان امنع ان حد يدخل على جهازى من نظام خارجى عن طريق فلاشة او حتى CD </p>
			<p> و عشان انفذ الخطوة ديه انا محتاج انى اعدل فى الملف /boot/grub/grub.conf  </p>
			<p> عن طريق انى اضيف السطر password --md5 $1$Wnvo.1$qz781HRVG4jUnJXmdSCZ30 </p>
			<h5> بعض مواطن الضعف فى ال hardware </h5>
			<ul>
				<li> Key logging: و هو برنامج اقدر اضيفة و اسجل كل حاجة كتبتها على ال keyboard  و منها ممكن اى حد يعرف ال password بتاعى </li>
				<li> Network sniffing: انى اتتبع اشارات ال network و اتدخل فيها و ازود نفسى بمعلومات عن الشبكة و عن الملفات اللى فيها </li>
				<li> انى اعمل boot من نظام تانى عن طريق فلاشة او CD </p>
				<li> Remounting and modifying disk content </li>
			</ul>
			<p> و عشان اقدر اامن الحاجات ديه انا محتاج </p>
			<ul>
				<li> انى اقفل ال workstation و ال servers </li>
				<li> انى احمى الشبكة بتاعتى و مسمحش باى حد غير مصرح ليه بالدخول ليها </li>
				<li> انى احمى ال keyboard بتاعتى من اى keylogger </li>
				<li> انى اعمل password و امنع اى حد من انه يقدر يعمل boot من اى device خارجى </li>
			</ul>
			
		</div>
	</body>
</html>